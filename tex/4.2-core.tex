\section{Особенности архитектуры PostgreSQL, влияющие на I/O-нагрузку}

PostgreSQL как одна из самых популярных реляционных СУБД имеет архитектурные особенности, которые напрямую влияют на характер нагрузки на подсистему ввода-вывода:

\begin{itemize}
    \item \textbf{Физическая организация хранения данных}: данные в PostgreSQL хранятся в виде таблиц и индексов в файловой системе. Каждая таблица или индекс представлен одним или несколькими файлами.
    \item \textbf{Механизм WAL (Write-Ahead Logging)}: все изменения сначала фиксируются в журнале предзаписи (WAL), что приводит к дополнительной нагрузке на запись.
    \item \textbf{Буферизация данных}: PostgreSQL использует собственный пул буферов для кеширования страниц данных в памяти, что снижает количество прямых обращений к диску.
    \item \textbf{Автоматические процессы обслуживания}: процессы \textit{autovacuum} и \textit{autoanalyze} выполняют фоновую 
                                работу по поддержанию базы данных в оптимальном состоянии, также внося вклад в I/O-нагрузку.
    \item \textbf{Методика выполнения запросов}: особенности планировщика запросов (\textit{Query Planner}) и используемые 
            ыим стратегии сканирования таблиц (sequential scan, index scan) влияют на количество операций чтения данных с диска.
\end{itemize}

Учитывая данные особенности, становится очевидным, что точная оценка I/O-нагрузки должна учитывать не только количество и 
характер запросов, но и внутренние механизмы работы PostgreSQL.

Ниже приведены развернутые описания каждого подхода, представленные выше в таблице. Текст дополняет информацию таблицы, 
раскрывая методологию и особенности каждого метода, не повторяя при этом данные, уже указанные в сравнительной характеристике.


\subsection{Параметры конфигурации влияющие на нагрузку на диск}

\begin{table}[h!]
\centering
\vspace{0.5em}
\begin{tabular}{|L{0.32\textwidth}|L{0.58\textwidth}|}
\hline
\textbf{Параметр} & \textbf{Описание} \\
\hline
shared\_buffers & Размер памяти для кэширования страниц базы данных. Меньший размер увеличивает количество обращений к диску. \\
\hline
work\_mem & Память на операции сортировки и хеширования. При нехватке используется временный файл на диске. \\
\hline
effective\_cache\_size & Оценка доступного файлового кеша ОС для планировщика запросов. \\
\hline
wal\_buffers & Буфер для временного хранения WAL-записей перед записью на диск. \\
\hline
checkpoint\_segments & Количество WAL-сегментов между контрольными точками (устарело, заменено на max\_wal\_size). \\
\hline
max\_wal\_size & Максимальный размер WAL, при достижении которого инициируется чекпоинт. \\
\hline
bgwriter\_lru\_maxpages & Максимальное количество страниц, записываемых background writer-ом за один проход. \\
\hline
bgwriter\_lru\_multiplier & Множитель для вычисления количества страниц, записываемых при нехватке буферов. \\
\hline
synchronous\_commit & Определяет, требуется ли подтверждение записи изменений на диск при коммите транзакции. \\
\hline
temp\_buffers & Память, выделяемая на временные таблицы. При нехватке создаются временные файлы на диске. \\
\hline
log\_temp\_files & Порог логирования временных файлов. Помогает обнаружить чрезмерное использование диска временными файлами. \\
\hline
\end{tabular}
\caption{Параметры PostgreSQL влияющие на нагрузку на диск}
\label{tab:io_params}
\end{table}


\subsection{Структура хранения данных в PostgreSQL}

Система управления базами данных PostgreSQL использует собственную файловую структуру для хранения данных, которая напрямую связана с логической моделью базы данных. 
Понимание физической организации данных является ключевым элементом для администрирования, оптимизации производительности и диагностики проблем, связанных с хранением и доступом к данным.

\subsubsection{Таблицы и файлы: связь объектов БД с файлами}

Каждая база данных в PostgreSQL представлена в файловой системе как каталог в директории \texttt{base/}, в котором хранятся файлы, соответствующие таблицам, индексам и другим объектам. 
Все объекты (таблицы, индексы и т.п.) имеют уникальный OID (object identifier), на основе которого создаётся имя файла. 
Например, таблица с OID 16423 будет храниться в файле \texttt{base/12345/16423}, где 12345 --- OID базы данных.

Каждый такой файл представляет собой физическое представление таблицы. Индексы и TOAST-таблицы также представлены отдельными файлами. \cite{postgres-docs}

\subsubsection{Каталожные таблицы и их физическое представление}

Системные каталоги PostgreSQL (например, \texttt{pg\_class}, \texttt{pg\_attribute}) реализованы как обычные таблицы и хранятся 
в файловой системе наравне с пользовательскими объектами. Они находятся в системной базе данных \texttt{postgres} или \texttt{template1}, 
и также представлены отдельными файлами с числовыми именами (OID).

\subsubsection{Сегментация файлов (segmenting) больших объектов}

В PostgreSQL существует ограничение на максимальный размер одного файла хранения данных --- по умолчанию 1~ГБ. 
Если размер таблицы или индекса превышает 1~ГБ, PostgreSQL автоматически делит его на сегменты. Эти сегменты именуются как 
\texttt{16423.1}, \texttt{16423.2} и т.д., где \texttt{16423} --- базовое имя файла, а суффиксы обозначают номер сегмента.

Это позволяет системе работать с очень большими таблицами, несмотря на ограничения ОС или файловой системы.

\subsubsection{Механизм TOAST и хранение больших данных}

TOAST (The Oversized-Attribute Storage Technique) --- это механизм, предназначенный для хранения очень больших значений полей, 
таких как текст или бинарные объекты. При превышении определённого размера (по умолчанию 2~КБ), такие значения автоматически 
выносятся в отдельную TOAST-таблицу, которая также хранится как обычный файл, связанный с основной таблицей.

TOAST-таблицы используют собственные механизмы сжатия и разбиения данных на чанки (chunks), что позволяет эффективно управлять большими объектами без перегрузки основной таблицы.

\subsubsection{Индексы и их файловая структура}

Индексы в PostgreSQL также реализованы как отдельные файлы. Например, B-Tree индекс хранится в виде страниц фиксированного размера 
(по умолчанию 8~КБ), содержащих ключи и указатели. Как и таблицы, при превышении 1~ГБ, индекс делится на сегменты.

Каждому индексу соответствует запись в каталоге \texttt{pg\_class}, а его физическое имя также строится по OID. 
Структура индекса зависит от его типа: B-Tree, Hash, GiST, GIN и т.д., но в любом случае он представлен в виде одного или нескольких сегментированных файлов.

\subsection{Журналирование и Write-Ahead Logging (WAL) в PostgreSQL}

Одним из основополагающих механизмов обеспечения надежности, согласованности данных и устойчивости к сбоям в системе управления 
базами данных PostgreSQL является организация журналирования на основе протокола Write-Ahead Logging (WAL). 
Этот механизм играет ключевую роль как при обычной работе с данными, так и в процессе восстановления после аварийных ситуаций.

\subsubsection{Принцип Write-Ahead Logging}

Write-Ahead Logging (WAL) --- это протокол, согласно которому любые изменения, вносимые в основные файловые структуры базы данных (таблицы и индексы), 
сначала фиксируются в специальном журнальном файле (WAL-журнале) до того, как сами данные будут непосредственно записаны на диск. 
Это обеспечивает атомарность и долговечность операций, соответствуя принципам управления транзакциями (ACID). \cite{fiskov2025wal}

Ключевой особенностью подхода WAL является следующий момент: ни одно изменение, связанное с данными, 
не считается завершённым, пока информация об этом изменении не будет зафиксирована в журнале. Только после этого модификация 
может быть отражена в основной структуре базы данных. Такой подход позволяет в случае сбоя или неожиданного завершения 
работы системы восстановить базу данных до целостного и согласованного состояния посредством «проигрывания» (replay) 
зафиксированных в WAL операций. \cite{Oparina2024}

\subsubsection{Роль WAL в оценке нагрузки и производительности}

Журналирование посредством WAL напрямую влияет на нагрузку на подсистему ввода-вывода: интенсивность операций по записи в WAL 
часто определяет требования к дисковой подсистеме, особенно при высоких уровнях параллелизма транзакций. 
Анализ объёма, частоты и параметров WAL-записей позволяет прогнозировать и оценивать нагрузку на I/O, 
а также уточнять требования к оборудованию и настройкам сервера. \cite{postgres-docs}

\vspace{1em} Таким образом, механизм Write-Ahead Logging является фундаментом обеспечения надёжности PostgreSQL, а также критически важным фактором для оценки и прогнозирования интегральной нагрузки на систему ввода-вывода при проектировании и эксплуатации СУБД.

\bigskip

Таким образом, физическая организация PostgreSQL напрямую отражает логическую структуру базы данных. 
Глубокое понимание связей между файлами и объектами БД позволяет администратору эффективно управлять хранением, планировать ресурсы и проводить тонкую настройку производительности.

